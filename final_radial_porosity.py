import matplotlib.pyplot as plt
import numpy as np
from scipy.optimize import curve_fit

res_100_r = "0.96, 0.96, 0.9571, 0.9564, 0.9579, 0.9587, 0.9593, 0.9596, 0.961, 0.9621, 0.9641, 0.9663, 0.9676, 0.9683, 0.9691, 0.9698, 0.9706, 0.9712, 0.9717, 0.9708, 0.9172, 0.855, 0.8057, 0.7589999999999999, 0.7091, 0.6645999999999999, 0.6180999999999999, 0.5823, 0.5547, 0.5360999999999999, 0.5199, 0.5028000000000001, 0.4881, 0.4695999999999999, 0.4519000000000001, 0.43600000000000005, 0.4245, 0.4151, 0.4081999999999999, 0.4012, 0.39480000000000004, 0.38869999999999993, 0.38739999999999986, 0.3869999999999999, 0.3829, 0.3807999999999999, 0.3782, 0.37729999999999997, 0.3771, 0.3758, 0.37629999999999997, 0.3761, 0.3768, 0.3781, 0.3786999999999999, 0.3791, 0.37929999999999997, 0.38049999999999995, 0.38129999999999986, 0.38369999999999993, 0.38639999999999997, 0.38959999999999995, 0.39469999999999994, 0.39749999999999996, 0.40069999999999995, 0.4034, 0.4073, 0.4111999999999999, 0.4153, 0.4203, 0.42689999999999995, 0.43309999999999993, 0.44310000000000005, 0.4528000000000001, 0.4625, 0.47350000000000003, 0.48619999999999985, 0.5006999999999999, 0.517, 0.5331999999999999, 0.5474999999999999, 0.5660000000000001, 0.5851, 0.6058999999999999, 0.6275, 0.6534, 0.6756, 0.6964, 0.7201, 0.7443, 0.7674000000000001, 0.7938999999999999, 0.823, 0.8501, 0.8784, 0.9069, 0.9319, 0.96, 0.9914, 1.0"
res_300_z = "0.9939444444444444, 0.8840666666666667, 0.7842555555555556, 0.6954444444444444, 0.6183444444444444, 0.5527555555555554, 0.49973333333333336, 0.46014444444444436, 0.4346888888888889, 0.4232666666666667, 0.4262666666666667, 0.44381111111111116, 0.4749444444444444, 0.5203777777777778, 0.5785888888888888, 0.6490666666666667, 0.6507000000000001, 0.6414222222222223, 0.6526666666666667, 0.6424555555555556, 0.5735555555555556, 0.5166666666666666, 0.47311111111111115, 0.4433222222222223, 0.42752222222222225, 0.42552222222222225, 0.4381222222222222, 0.4645222222222223, 0.5049777777777777, 0.5581666666666667, 0.6241444444444444, 0.6567222222222222, 0.6407111111111111, 0.6454111111111112, 0.6599333333333334, 0.5958000000000001, 0.535511111111111, 0.4880888888888889, 0.4534111111111111, 0.43272222222222223, 0.42646666666666666, 0.43479999999999996, 0.4570444444444445, 0.4931888888888888, 0.5427444444444445, 0.6044555555555555, 0.6637222222222222, 0.6442, 0.6417444444444445, 0.6605777777777777, 0.6151333333333333, 0.5505666666666666, 0.4987222222222223, 0.46020000000000005, 0.4352666666666667, 0.42485555555555554, 0.42842222222222226, 0.4459777777777777, 0.4780444444444444, 0.5231222222222223, 0.5813666666666666, 0.6525666666666667, 0.6475888888888889, 0.6402333333333333, 0.6527777777777777, 0.6395444444444444, 0.5711999999999999, 0.5155333333333334, 0.4727444444444444, 0.44357777777777774, 0.4277777777777778, 0.42689999999999995, 0.4408888888888889, 0.46872222222222226, 0.5091666666666667, 0.5633333333333334, 0.6302666666666666, 0.6565777777777777, 0.6416333333333333, 0.6464333333333334, 0.6601777777777778, 0.5899555555555556, 0.5299555555555555, 0.4830444444444445, 0.4494555555555556, 0.4296444444444444, 0.42456666666666654, 0.43298888888888887, 0.45600000000000007, 0.49257777777777767, 0.5427444444444445, 0.6058444444444444, 0.6569555555555555, 0.6438333333333333, 0.6432777777777777, 0.6609, 0.6137666666666666, 0.5497777777777778, 0.49855555555555553, 0.4604111111111111, 0.4361333333333335, 0.4259777777777778, 0.4301222222222221, 0.4487444444444445, 0.4813555555555554, 0.5270888888888889, 0.5860666666666666, 0.6574333333333333, 0.6766444444444444, 0.6937888888888888, 0.7291222222222222, 0.7296888888888888, 0.6780222222222223, 0.6359111111111111, 0.6037222222222223, 0.5817333333333334, 0.5702555555555555, 0.5693111111111111, 0.5789444444444445, 0.5991222222222222, 0.6297, 0.6701666666666666, 0.6798111111111111, 0.6874555555555555, 0.7095555555555556, 0.6981888888888889, 0.6813444444444445, 0.587488888888889, 0.4986666666666667, 0.44557777777777785, 0.41127777777777774, 0.3922444444444445, 0.38736666666666675, 0.3952, 0.40959999999999996, 0.41432222222222215, 0.4343, 0.4585111111111111, 0.4563555555555556, 0.47738888888888886, 0.5355888888888889, 0.5580555555555556, 0.5534999999999999, 0.5514666666666667, 0.5111000000000001, 0.4847555555555556, 0.47153333333333325, 0.4720777777777778, 0.48640000000000005, 0.5141777777777778, 0.5475888888888888, 0.5747555555555556, 0.6167444444444445, 0.6380888888888889, 0.6522333333333334, 0.6690666666666667, 0.6576444444444445, 0.6233111111111111, 0.5784222222222222, 0.5483444444444444, 0.5256777777777778, 0.4959444444444443, 0.47967777777777765, 0.4772222222222223, 0.4881444444444444, 0.5124666666666666, 0.5231666666666666, 0.5489888888888889, 0.5891888888888889, 0.6280555555555556, 0.6405333333333334, 0.6483222222222222, 0.6308888888888888, 0.6021111111111112, 0.5674666666666667, 0.5399666666666666, 0.5149777777777778, 0.48772222222222217, 0.4736555555555555, 0.4735555555555555, 0.48707777777777783, 0.5144333333333333, 0.55, 0.5766, 0.6083888888888889, 0.6333111111111112, 0.6355, 0.6332666666666666, 0.6410666666666667, 0.6375555555555554, 0.5989333333333333, 0.5627666666666666, 0.5194666666666667, 0.4898111111111111, 0.4734666666666666, 0.4709333333333332, 0.48157777777777777, 0.5064000000000001, 0.5374777777777777, 0.5619222222222222, 0.5998222222222223, 0.6180888888888889, 0.6291777777777778, 0.6430111111111112, 0.6462666666666667, 0.6238888888888889, 0.578811111111111, 0.5490444444444444, 0.5222, 0.492388888888889, 0.4762666666666666, 0.4731444444444445, 0.4843666666666667, 0.5089777777777778, 0.5283444444444445, 0.5537666666666666, 0.5926111111111111, 0.6306777777777779, 0.6432111111111111, 0.6523777777777777, 0.6347444444444443, 0.6065666666666667, 0.5708777777777778, 0.5422222222222222, 0.5151555555555556, 0.4863777777777778, 0.47109999999999996, 0.469211111111111, 0.48131111111111113, 0.5073666666666665, 0.5468555555555557, 0.5775111111111111, 0.6162222222222222, 0.6399555555555556, 0.6416222222222223, 0.6370666666666667, 0.6428666666666667, 0.6409888888888888, 0.6202777777777778, 0.5836333333333332, 0.5366444444444445, 0.5025555555555556, 0.4819333333333333, 0.4745555555555556, 0.48176666666666657, 0.5019888888888888, 0.5356666666666666, 0.5646666666666667, 0.5981555555555556, 0.6437, 0.6586555555555555, 0.6765333333333334, 0.6804222222222223, 0.6427333333333334, 0.5898111111111111, 0.5503888888888889, 0.5256333333333334, 0.49715555555555546, 0.4726111111111111, 0.46196666666666664, 0.4654666666666667, 0.4820888888888889, 0.5128444444444444, 0.5507222222222221, 0.5801888888888889, 0.6252444444444445, 0.656711111111111, 0.6490444444444444, 0.6512888888888888, 0.6424666666666667, 0.6185555555555555, 0.5804444444444445, 0.5361222222222222, 0.4964333333333334, 0.4711333333333333, 0.4594666666666667, 0.46143333333333336, 0.4771222222222222, 0.5066333333333334, 0.5493888888888889, 0.5897555555555556, 0.6317333333333333, 0.6452888888888889, 0.6479555555555555, 0.6489555555555555, 0.6558444444444445, 0.6299333333333332, 0.6163666666666667, 0.6053999999999999, 0.5859000000000001, 0.5768444444444445, 0.5786444444444444, 0.5902888888888889, 0.6129333333333333, 0.6450666666666667, 0.6878111111111112, 0.7393666666666667, 0.8000444444444444, 0.8689666666666667, 0.9205333333333333"

def f5(x,a,b,c,d,e,f):
    return f*x**5+e*x**4+d*x**3+c*x**2+b*x+a

def f2(x,a,b,c):
    return c*x**2+b*x+a

if __name__ == "__main__":

    print("start")
    # st = "0.9939444444444444, 0.8840666666666667, 0.7842555555555556, 0.6954444444444444, 0.6183444444444444, 0.5527555555555554, 0.49973333333333336, 0.46014444444444436, 0.4346888888888889, 0.4232666666666667, 0.4262666666666667, 0.44381111111111116, 0.4749444444444444, 0.5203777777777778, 0.5785888888888888, 0.6490666666666667, 0.6507000000000001, 0.6414222222222223, 0.6526666666666667, 0.6424555555555556, 0.5735555555555556, 0.5166666666666666, 0.47311111111111115, 0.4433222222222223, 0.42752222222222225, 0.42552222222222225, 0.4381222222222222, 0.4645222222222223, 0.5049777777777777, 0.5581666666666667, 0.6241444444444444, 0.6567222222222222, 0.6407111111111111, 0.6454111111111112, 0.6599333333333334, 0.5958000000000001, 0.535511111111111, 0.4880888888888889, 0.4534111111111111, 0.43272222222222223, 0.42646666666666666, 0.43479999999999996, 0.4570444444444445, 0.4931888888888888, 0.5427444444444445, 0.6044555555555555, 0.6637222222222222, 0.6442, 0.6417444444444445, 0.6605777777777777, 0.6151333333333333, 0.5505666666666666, 0.4987222222222223, 0.46020000000000005, 0.4352666666666667, 0.42485555555555554, 0.42842222222222226, 0.4459777777777777, 0.4780444444444444, 0.5231222222222223, 0.5813666666666666, 0.6525666666666667, 0.6475888888888889, 0.6402333333333333, 0.6527777777777777, 0.6395444444444444, 0.5711999999999999, 0.5155333333333334, 0.4727444444444444, 0.44357777777777774, 0.4277777777777778, 0.42689999999999995, 0.4408888888888889, 0.46872222222222226, 0.5091666666666667, 0.5633333333333334, 0.6302666666666666, 0.6565777777777777, 0.6416333333333333, 0.6464333333333334, 0.6601777777777778, 0.5899555555555556, 0.5299555555555555, 0.4830444444444445, 0.4494555555555556, 0.4296444444444444, 0.42456666666666654, 0.43298888888888887, 0.45600000000000007, 0.49257777777777767, 0.5427444444444445, 0.6058444444444444, 0.6569555555555555, 0.6438333333333333, 0.6432777777777777, 0.6609, 0.6137666666666666, 0.5497777777777778, 0.49855555555555553, 0.4604111111111111, 0.4361333333333335, 0.4259777777777778, 0.4301222222222221, 0.4487444444444445, 0.4813555555555554, 0.5270888888888889, 0.5860666666666666, 0.6574333333333333, 0.6766444444444444, 0.6937888888888888, 0.7291222222222222, 0.7296888888888888, 0.6780222222222223, 0.6359111111111111, 0.6037222222222223, 0.5817333333333334, 0.5702555555555555, 0.5693111111111111, 0.5789444444444445, 0.5991222222222222, 0.6297, 0.6701666666666666, 0.6798111111111111, 0.6874555555555555, 0.7095555555555556, 0.6981888888888889, 0.6813444444444445, 0.587488888888889, 0.4986666666666667, 0.44557777777777785, 0.41127777777777774, 0.3922444444444445, 0.38736666666666675, 0.3952, 0.40959999999999996, 0.41432222222222215, 0.4343, 0.4585111111111111, 0.4563555555555556, 0.47738888888888886, 0.5355888888888889, 0.5580555555555556, 0.5534999999999999, 0.5514666666666667, 0.5111000000000001, 0.4847555555555556, 0.47153333333333325, 0.4720777777777778, 0.48640000000000005, 0.5141777777777778, 0.5475888888888888, 0.5747555555555556, 0.6167444444444445, 0.6380888888888889, 0.6522333333333334, 0.6690666666666667, 0.6576444444444445, 0.6233111111111111, 0.5784222222222222, 0.5483444444444444, 0.5256777777777778, 0.4959444444444443, 0.47967777777777765, 0.4772222222222223, 0.4881444444444444, 0.5124666666666666, 0.5231666666666666, 0.5489888888888889, 0.5891888888888889, 0.6280555555555556, 0.6405333333333334, 0.6483222222222222, 0.6308888888888888, 0.6021111111111112, 0.5674666666666667, 0.5399666666666666, 0.5149777777777778, 0.48772222222222217, 0.4736555555555555, 0.4735555555555555, 0.48707777777777783, 0.5144333333333333, 0.55, 0.5766, 0.6083888888888889, 0.6333111111111112, 0.6355, 0.6332666666666666, 0.6410666666666667, 0.6375555555555554, 0.5989333333333333, 0.5627666666666666, 0.5194666666666667, 0.4898111111111111, 0.4734666666666666, 0.4709333333333332, 0.48157777777777777, 0.5064000000000001, 0.5374777777777777, 0.5619222222222222, 0.5998222222222223, 0.6180888888888889, 0.6291777777777778, 0.6430111111111112, 0.6462666666666667, 0.6238888888888889, 0.578811111111111, 0.5490444444444444, 0.5222, 0.492388888888889, 0.4762666666666666, 0.4731444444444445, 0.4843666666666667, 0.5089777777777778, 0.5283444444444445, 0.5537666666666666, 0.5926111111111111, 0.6306777777777779, 0.6432111111111111, 0.6523777777777777, 0.6347444444444443, 0.6065666666666667, 0.5708777777777778, 0.5422222222222222, 0.5151555555555556, 0.4863777777777778, 0.47109999999999996, 0.469211111111111, 0.48131111111111113, 0.5073666666666665, 0.5468555555555557, 0.5775111111111111, 0.6162222222222222, 0.6399555555555556, 0.6416222222222223, 0.6370666666666667, 0.6428666666666667, 0.6409888888888888, 0.6202777777777778, 0.5836333333333332, 0.5366444444444445, 0.5025555555555556, 0.4819333333333333, 0.4745555555555556, 0.48176666666666657, 0.5019888888888888, 0.5356666666666666, 0.5646666666666667, 0.5981555555555556, 0.6437, 0.6586555555555555, 0.6765333333333334, 0.6804222222222223, 0.6427333333333334, 0.5898111111111111, 0.5503888888888889, 0.5256333333333334, 0.49715555555555546, 0.4726111111111111, 0.46196666666666664, 0.4654666666666667, 0.4820888888888889, 0.5128444444444444, 0.5507222222222221, 0.5801888888888889, 0.6252444444444445, 0.656711111111111, 0.6490444444444444, 0.6512888888888888, 0.6424666666666667, 0.6185555555555555, 0.5804444444444445, 0.5361222222222222, 0.4964333333333334, 0.4711333333333333, 0.4594666666666667, 0.46143333333333336, 0.4771222222222222, 0.5066333333333334, 0.5493888888888889, 0.5897555555555556, 0.6317333333333333, 0.6452888888888889, 0.6479555555555555, 0.6489555555555555, 0.6558444444444445, 0.6299333333333332, 0.6163666666666667, 0.6053999999999999, 0.5859000000000001, 0.5768444444444445, 0.5786444444444444, 0.5902888888888889, 0.6129333333333333, 0.6450666666666667, 0.6878111111111112, 0.7393666666666667, 0.8000444444444444, 0.8689666666666667, 0.9205333333333333"
    st = res_100_r
    porosities = [float(p) for p in st.split(",")]
    # porosities = []
    # for p in porosities:
    #     p = float(p)
    # with open('plot_poros.csv','w') as poros_out:
    #     poros_out.write("porosity\n")
    #     for p in porosities:
    #         poros_out.write(p)


    print(porosities)

    resolution = 100
    rs = np.linspace(0, 5 / 16, resolution)

    plt.plot(rs,porosities)
    print("r 19 ",rs[19])
    print("eps 19 ",porosities[19])
    print("r 20 ",rs[20])
    print("eps 20 ",porosities[20])
    popt_out, pcov_out = curve_fit(f5,rs[19:],porosities[19:])
    print("popt out")
    print(popt_out)
    plt.plot(rs[19:], f5(rs[19:], *popt_out), 'r-',
             label='fit: a=%5.3f, b=%5.3f, c=%5.3f, d=%5.3f, e=%5.3f, f=%5.3f' % tuple(popt_out))
    popt_in, pcov_in = curve_fit(f2, rs[:20], porosities[:20])
    print("popt in")
    print(popt_in)
    plt.plot(rs[:20], f2(rs[:20], *popt_in), 'g-',
             label='fit: a=%5.3f, b=%5.3f, c=%5.3f' % tuple(popt_in))

    plt.show()